# Progress Log

This file tracks AI-assisted development progress.
Each entry documents: date, feature, decisions, files changed, tests, and concerns.

---

[2026-02-08] #371 chore: replace custom semrel actions with standard semantic-release
- Files: .github/workflows/ci-cd.yml, .github/workflows/deploy-docs.yml, .github/workflows/renovate.yml, libs/act/.releaserc.json, libs/act-pg/.releaserc.json, package.json, pnpm-lock.yaml
- Changes: Replaced rotorsoft/semrel-analyze and rotorsoft/semrel-release with semantic-release + official plugins. Updated all GitHub Actions to latest major versions. Added per-library .releaserc.json configs with semantic-release-monorepo for commit filtering.
- Decisions: Used @semantic-release/exec with pnpm publish (instead of @semantic-release/npm publish) to resolve workspace:* protocol in act-pg dependencies. Preserved existing tag format (@rotorsoft/<lib>-v${version}) via explicit tagFormat. Added git pull --rebase step in CD job so second matrix lib picks up commits from first.
- Issues: Dry-run on feature branch recommended before merging to master. Verify NPM_TOKEN and GITHUB_TOKEN secrets are configured.

[2026-02-08] #371 docs: improve published library README files
- Files: libs/act/README.md, libs/act-pg/README.md
- Changes: Added npm downloads, build status, coverage, and license badges to both library READMEs. Added installation, quick start, and related links sections to act README while preserving all existing documentation. Rewrote act-pg README with full usage docs, configuration table, feature list, and database schema reference.

[2026-02-11] #378 feat: support partial Zod schemas for partial states
- Files: libs/act/src/act-builder.ts, libs/act/test/partial-state.spec.ts, packages/wolfdesk/src/schemas/ticket.state.schemas.ts, packages/wolfdesk/src/ticket-invariants.ts, packages/wolfdesk/src/ticket-creation.ts, packages/wolfdesk/src/ticket-messaging.ts, packages/wolfdesk/src/ticket-operations.ts, packages/wolfdesk/src/ticket.ts, packages/wolfdesk/test/ticket.spec.ts, packages/wolfdesk/test/tickets.spec.ts
- Changes: Added schema merging (baseTypeName, mergeSchemas, mergeInits helpers) to act-builder.ts so each partial state only declares the Zod fields it needs. Schemas are merged via ZodObject.extend() when partials share the same state name, with conflict detection for overlapping keys with different base types. Init functions are merged by spreading results. WolfDesk updated with inline per-slice z.object() schemas in each state declaration and inline inits. Invariants re-typed against minimal interfaces.
- Decisions: Used ZodObject.extend() for schema merging (native Zod v4 API). Used constructor.name + unwrap() for base type comparison. Kept full Ticket schema for backward compat and test type assertions. Invariants typed with minimal interfaces (TypeScript contravariance makes Invariant<SuperType> assignable to Invariant<SubType>).
- Tests: 6 new test cases added to partial-state.spec.ts (partial schema merge, init merge, overlapping keys same type, overlapping keys different types, cross-partial reconstruction, optional wrapping). All 15 partial-state tests pass. All WolfDesk tests pass.

[2026-02-11] #378 feat: add load-by-name to Act and simplify WolfDesk ticket barrel
- Files: libs/act/src/act.ts, libs/act/test/partial-state.spec.ts, packages/wolfdesk/src/ticket.ts, packages/wolfdesk/test/ticket.spec.ts, packages/wolfdesk/test/tickets.spec.ts
- Changes: Added string overload to Act.load() so merged states can be loaded by name (e.g. app.load("Ticket", stream)) without importing a partial. Removed manual TicketState type intersection and Ticket alias from ticket.ts barrel. Updated WolfDesk tests to use string-based load.
- Decisions: String overload returns Snapshot<Schema, Schemas> (Record<string, any>) — property access works without casts. Added `any` annotations on Object.values().at() results to work around TS 5.9 change where Object.values(any) returns unknown[].
- Tests: 2 new tests (load by name, throw on unknown name). All 17 partial-state tests and all WolfDesk tests pass.

[2026-02-12] #382 feat: add slice builder to compose partial states with reactions
- Files: libs/act/src/merge.ts (new), libs/act/src/slice-builder.ts (new), libs/act/test/slice.spec.ts (new), libs/act/src/act-builder.ts, libs/act/src/index.ts, packages/wolfdesk/src/bootstrap.ts, packages/wolfdesk/src/tickets.ts
- Changes: Extracted shared merge utilities (baseTypeName, mergeSchemas, mergeInits, registerState, _this_, _void_) into merge.ts. Created slice-builder.ts with Slice type, isSlice guard, and slice() fluent builder. Updated act-builder.ts to accept Slice via .with() overload using isSlice() discriminant. Refactored WolfDesk to use vertical slices — projection reactions in slices, orchestration reactions at act level.
- Decisions: Used _tag:"Slice" discriminant for runtime type checking. Added phantom fields (_S, _M) to preserve unused generic parameters. Changed WolfDesk tickets.ts to use CommittedOf<typeof State.events> instead of AsCommitted<typeof builder.events> to break circular module dependency. Cross-slice reactions use default _this_ resolver (not _void_) because void resolver returns undefined and reactions are filtered during drain.
- Tests: 13 new tests in slice.spec.ts covering: building, reactions (.void/.to), act+slice merge, multi-slice composition, partial state merging across slices, duplicate action/event detection, cross-slice reactions, backward compat, mixed slices+states, .events exposure, multiple partials in single slice. All 209 tests pass.

[2026-02-13] #386 feat: add projection builder and extract shared schemas
- Files: libs/act/src/projection-builder.ts (new), libs/act/test/projection.spec.ts (new), packages/wolfdesk/src/schemas/ticket.event.schemas.ts (new), packages/wolfdesk/src/schemas/ticket.action.schemas.ts (new), libs/act/src/act-builder.ts, libs/act/src/index.ts, packages/wolfdesk/src/schemas/index.ts, packages/wolfdesk/src/bootstrap.ts, packages/wolfdesk/src/ticket-creation.ts, packages/wolfdesk/src/ticket-messaging.ts, packages/wolfdesk/src/ticket-operations.ts, packages/wolfdesk/src/ticket-projections.ts, packages/wolfdesk/src/ticket.ts
- Changes: Created projection() builder with .on({ Event }).do(handler).to(resolver) fluent API using record shorthand to infer event name from variable name. Projection type with _tag:"Projection" discriminant and isProjection() guard. Optional default target via projection("target") inherited by all handlers with per-handler .to()/.void() override. Updated act-builder .with() to accept Projection and merge reactions with name-collision deduplication. Extracted all wolfdesk event and action Zod schemas into shared schema files. Refactored ticket-projections.ts to use projection("tickets") builder with .on({ TicketOpened }) shorthand. Simplified bootstrap.ts to use .with(TicketProjection).
- Decisions: Projection .on() takes single-key record { EventName: schema } — uses Object.keys(entry)[0] to extract event name and entry[event] for schema, enabling JS shorthand { TicketOpened } when variable matches event name. Optional default target as first arg to projection(). Projection handlers receive (event, stream) without Dispatcher since they are pure side-effect handlers. Name collisions during projection merge resolved by appending "_p" suffix.
- Tests: 15 new tests in projection.spec.ts covering: build shape, isProjection guard, default target inheritance, _this_ fallback, string/function/void per-handler resolver overrides, named/anonymous handlers, multiple events with default target, act+projection merge, act+slice+projection merge, multiple handlers same event, projection-only events, .events exposure. All 228 tests pass, 100% coverage.

[2026-02-13] #386 refactor: apply record shorthand to state builder .on()
- Files: libs/act/src/state-builder.ts, packages/wolfdesk/src/ticket-creation.ts, packages/wolfdesk/src/ticket-messaging.ts, packages/wolfdesk/src/ticket-operations.ts, packages/calculator/src/calculator.ts, packages/calculator/src/main.ts, libs/act/test/state-builder.spec.ts, libs/act/test/event-sourcing.spec.ts, libs/act/test/act.spec.ts, libs/act/test/builder.spec.ts, libs/act/test/partial-state.spec.ts, libs/act/test/slice.spec.ts, libs/act/test/projection.spec.ts, libs/act/test/type-check.ts, libs/act/test/calculator.ts, libs/act/test/digit-board.ts, libs/act-pg/test/app.ts, libs/act/src/act-builder.ts, libs/act/src/utils.ts, libs/act/src/types/action.ts, CLAUDE.md
- Changes: Changed state builder .on() from two-argument form .on("ActionName", schema) to single-argument record shorthand .on({ ActionName: schema }). Added ActionEntry<K, AX> helper type (same pattern as EventEntry in projection-builder). Updated action_builder implementation to extract key via Object.keys(entry)[0] and value as schema. Updated all call sites across WolfDesk (10 calls), calculator (4 calls), test files (~65 calls), and JSDoc examples in source files.
- Decisions: Followed same pattern as projection-builder's EventEntry type. Enables JS shorthand .on({ OpenTicket }) when variable name matches action name. WolfDesk states benefit most since action schema variable names already match action names. Calculator and test files use explicit key: value form since schemas are inline or namespaced.
- Tests: All 228 tests pass, 100% coverage.
