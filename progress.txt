# Progress Log

This file tracks AI-assisted development progress.
Each entry documents: date, feature, decisions, files changed, tests, and concerns.

---

[2026-02-08] #371 chore: replace custom semrel actions with standard semantic-release
- Files: .github/workflows/ci-cd.yml, .github/workflows/deploy-docs.yml, .github/workflows/renovate.yml, libs/act/.releaserc.json, libs/act-pg/.releaserc.json, package.json, pnpm-lock.yaml
- Changes: Replaced rotorsoft/semrel-analyze and rotorsoft/semrel-release with semantic-release + official plugins. Updated all GitHub Actions to latest major versions. Added per-library .releaserc.json configs with semantic-release-monorepo for commit filtering.
- Decisions: Used @semantic-release/exec with pnpm publish (instead of @semantic-release/npm publish) to resolve workspace:* protocol in act-pg dependencies. Preserved existing tag format (@rotorsoft/<lib>-v${version}) via explicit tagFormat. Added git pull --rebase step in CD job so second matrix lib picks up commits from first.
- Issues: Dry-run on feature branch recommended before merging to master. Verify NPM_TOKEN and GITHUB_TOKEN secrets are configured.

[2026-02-08] #371 docs: improve published library README files
- Files: libs/act/README.md, libs/act-pg/README.md
- Changes: Added npm downloads, build status, coverage, and license badges to both library READMEs. Added installation, quick start, and related links sections to act README while preserving all existing documentation. Rewrote act-pg README with full usage docs, configuration table, feature list, and database schema reference.

[2026-02-11] #378 feat: support partial Zod schemas for partial states
- Files: libs/act/src/act-builder.ts, libs/act/test/partial-state.spec.ts, packages/wolfdesk/src/schemas/ticket.state.schemas.ts, packages/wolfdesk/src/ticket-invariants.ts, packages/wolfdesk/src/ticket-creation.ts, packages/wolfdesk/src/ticket-messaging.ts, packages/wolfdesk/src/ticket-operations.ts, packages/wolfdesk/src/ticket.ts, packages/wolfdesk/test/ticket.spec.ts, packages/wolfdesk/test/tickets.spec.ts
- Changes: Added schema merging (baseTypeName, mergeSchemas, mergeInits helpers) to act-builder.ts so each partial state only declares the Zod fields it needs. Schemas are merged via ZodObject.extend() when partials share the same state name, with conflict detection for overlapping keys with different base types. Init functions are merged by spreading results. WolfDesk updated with inline per-slice z.object() schemas in each state declaration and inline inits. Invariants re-typed against minimal interfaces.
- Decisions: Used ZodObject.extend() for schema merging (native Zod v4 API). Used constructor.name + unwrap() for base type comparison. Kept full Ticket schema for backward compat and test type assertions. Invariants typed with minimal interfaces (TypeScript contravariance makes Invariant<SuperType> assignable to Invariant<SubType>).
- Tests: 6 new test cases added to partial-state.spec.ts (partial schema merge, init merge, overlapping keys same type, overlapping keys different types, cross-partial reconstruction, optional wrapping). All 15 partial-state tests pass. All WolfDesk tests pass.

[2026-02-11] #378 feat: add load-by-name to Act and simplify WolfDesk ticket barrel
- Files: libs/act/src/act.ts, libs/act/test/partial-state.spec.ts, packages/wolfdesk/src/ticket.ts, packages/wolfdesk/test/ticket.spec.ts, packages/wolfdesk/test/tickets.spec.ts
- Changes: Added string overload to Act.load() so merged states can be loaded by name (e.g. app.load("Ticket", stream)) without importing a partial. Removed manual TicketState type intersection and Ticket alias from ticket.ts barrel. Updated WolfDesk tests to use string-based load.
- Decisions: String overload returns Snapshot<Schema, Schemas> (Record<string, any>) — property access works without casts. Added `any` annotations on Object.values().at() results to work around TS 5.9 change where Object.values(any) returns unknown[].
- Tests: 2 new tests (load by name, throw on unknown name). All 17 partial-state tests and all WolfDesk tests pass.

[2026-02-12] #382 feat: add slice builder to compose partial states with reactions
- Files: libs/act/src/merge.ts (new), libs/act/src/slice-builder.ts (new), libs/act/test/slice.spec.ts (new), libs/act/src/act-builder.ts, libs/act/src/index.ts, packages/wolfdesk/src/bootstrap.ts, packages/wolfdesk/src/tickets.ts
- Changes: Extracted shared merge utilities (baseTypeName, mergeSchemas, mergeInits, registerState, _this_, _void_) into merge.ts. Created slice-builder.ts with Slice type, isSlice guard, and slice() fluent builder. Updated act-builder.ts to accept Slice via .with() overload using isSlice() discriminant. Refactored WolfDesk to use vertical slices — projection reactions in slices, orchestration reactions at act level.
- Decisions: Used _tag:"Slice" discriminant for runtime type checking. Added phantom fields (_S, _M) to preserve unused generic parameters. Changed WolfDesk tickets.ts to use CommittedOf<typeof State.events> instead of AsCommitted<typeof builder.events> to break circular module dependency. Cross-slice reactions use default _this_ resolver (not _void_) because void resolver returns undefined and reactions are filtered during drain.
- Tests: 13 new tests in slice.spec.ts covering: building, reactions (.void/.to), act+slice merge, multi-slice composition, partial state merging across slices, duplicate action/event detection, cross-slice reactions, backward compat, mixed slices+states, .events exposure, multiple partials in single slice. All 209 tests pass.

[2026-02-13] #386 feat: add projection builder and extract shared schemas
- Files: libs/act/src/projection-builder.ts (new), libs/act/test/projection.spec.ts (new), packages/wolfdesk/src/schemas/ticket.event.schemas.ts (new), packages/wolfdesk/src/schemas/ticket.action.schemas.ts (new), libs/act/src/act-builder.ts, libs/act/src/index.ts, packages/wolfdesk/src/schemas/index.ts, packages/wolfdesk/src/bootstrap.ts, packages/wolfdesk/src/ticket-creation.ts, packages/wolfdesk/src/ticket-messaging.ts, packages/wolfdesk/src/ticket-operations.ts, packages/wolfdesk/src/ticket-projections.ts, packages/wolfdesk/src/ticket.ts
- Changes: Created projection() builder with .on({ Event }).do(handler).to(resolver) fluent API using record shorthand to infer event name from variable name. Projection type with _tag:"Projection" discriminant and isProjection() guard. Optional default target via projection("target") inherited by all handlers with per-handler .to()/.void() override. Updated act-builder .with() to accept Projection and merge reactions with name-collision deduplication. Extracted all wolfdesk event and action Zod schemas into shared schema files. Refactored ticket-projections.ts to use projection("tickets") builder with .on({ TicketOpened }) shorthand. Simplified bootstrap.ts to use .with(TicketProjection).
- Decisions: Projection .on() takes single-key record { EventName: schema } — uses Object.keys(entry)[0] to extract event name and entry[event] for schema, enabling JS shorthand { TicketOpened } when variable matches event name. Optional default target as first arg to projection(). Projection handlers receive (event, stream) without Dispatcher since they are pure side-effect handlers. Name collisions during projection merge resolved by appending "_p" suffix.
- Tests: 15 new tests in projection.spec.ts covering: build shape, isProjection guard, default target inheritance, _this_ fallback, string/function/void per-handler resolver overrides, named/anonymous handlers, multiple events with default target, act+projection merge, act+slice+projection merge, multiple handlers same event, projection-only events, .events exposure. All 228 tests pass, 100% coverage.

[2026-02-13] #386 refactor: apply record shorthand to state builder .on()
- Files: libs/act/src/state-builder.ts, packages/wolfdesk/src/ticket-creation.ts, packages/wolfdesk/src/ticket-messaging.ts, packages/wolfdesk/src/ticket-operations.ts, packages/calculator/src/calculator.ts, packages/calculator/src/main.ts, libs/act/test/state-builder.spec.ts, libs/act/test/event-sourcing.spec.ts, libs/act/test/act.spec.ts, libs/act/test/builder.spec.ts, libs/act/test/partial-state.spec.ts, libs/act/test/slice.spec.ts, libs/act/test/projection.spec.ts, libs/act/test/type-check.ts, libs/act/test/calculator.ts, libs/act/test/digit-board.ts, libs/act-pg/test/app.ts, libs/act/src/act-builder.ts, libs/act/src/utils.ts, libs/act/src/types/action.ts, CLAUDE.md
- Changes: Changed state builder .on() from two-argument form .on("ActionName", schema) to single-argument record shorthand .on({ ActionName: schema }). Added ActionEntry<K, AX> helper type (same pattern as EventEntry in projection-builder). Updated action_builder implementation to extract key via Object.keys(entry)[0] and value as schema. Updated all call sites across WolfDesk (10 calls), calculator (4 calls), test files (~65 calls), and JSDoc examples in source files.
- Decisions: Followed same pattern as projection-builder's EventEntry type. Enables JS shorthand .on({ OpenTicket }) when variable name matches action name. WolfDesk states benefit most since action schema variable names already match action names. Calculator and test files use explicit key: value form since schemas are inline or namespaced.
- Tests: All 228 tests pass, 100% coverage.

[2026-02-13] #388 docs: update all documentation with latest builder API changes
- Files: README.md, AGENT.md, CLAUDE.md, libs/act/README.md, libs/act-pg/README.md, docs/docs/intro.md, docs/docs/concepts/configuration.md, docs/docs/concepts/event-sourcing.mdx, docs/docs/concepts/state-management.mdx, docs/docs/api/act/src/functions/state.md, progress.txt
- Changes: Replaced all .on("name", schema) two-argument syntax with .on({ name: schema }) record shorthand across all docs. Added Projection Builder and Slice Builder sections to CLAUDE.md and AGENT.md with API signatures and examples. Updated Act Orchestrator docs to show .with() accepting State/Slice/Projection. Added projection/slice examples to root README and libs/act/README. Updated Code Organization sections with new builder files.
- Decisions: Documented handler signature differences: projection handlers get (event, stream), slice handlers get (event, stream, app). Slice .on() uses string event names (not record shorthand) since events come from registered states.

[2026-02-13] #390 feat: replace state("Name", schema) with state({ Name: schema }) record shorthand
- Files: libs/act/src/state-builder.ts, libs/act/test/state-builder.spec.ts, docs/static/index.html, performance/act-performance/package.json, all test files, all example packages, all docs
- Changes: Replaced state() two-argument signature with single-argument record shorthand state({ Name: schema }), matching .on() pattern. Updated all call sites across tests, examples (calculator, wolfdesk, performance), and documentation. Fixed outdated .on() syntax in landing page. Bumped performance @rotorsoft/act dep to ^0.10.0.
- Decisions: Breaking change — no backward compat for old two-arg form. Same StateEntry pattern as ActionEntry. Runtime throws on non-single-key records.
- Tests: 5 new tests for record shorthand. All 235 tests pass, 100% coverage.

[2026-02-13] #392 fix(calculator): fix calculator main.ts and add advanced composition patterns panel
- Files: packages/calculator/src/main.ts, packages/calculator/package.json, docs/static/index.html, pnpm-lock.yaml
- Changes: Fixed calculator dependency from ^0.6.33 (stale npm) to workspace:* so it uses the local framework with record shorthand API. Added stop_correlations() cleanup so process exits. Added advanced composition patterns panel to landing page with 5 tabbed sections (Vertical Slices, Projections, Partial States, Invariants, Orchestrator) using real WolfDesk code examples.
- Decisions: Used workspace:* to match other example packages. Tabs use Prism.js for syntax highlighting (already loaded by landing page). Kept panel static per issue requirements.
- Issues: Pre-existing lint/typecheck errors unrelated to this change (missing client/tsconfig.eslint.json, unused @ts-expect-error directives).

[2026-02-13] #394 fix(calculator): replace workspace:* with published npm version for StackBlitz compatibility
- Files: packages/calculator/package.json, pnpm-lock.yaml
- Changes: Replaced "workspace:*" with "^0.11.0" for @rotorsoft/act dependency so StackBlitz (which uses npm, not pnpm) can resolve the package. Matches approach used by performance/act-performance.
- Decisions: Used ^0.11.0 (current published version). pnpm resolves published versions to local workspace packages when available, so local dev is unaffected.

[2026-02-14] #398 docs: add scaffold-act-app Claude Code skill
- Files: .claude/skills/scaffold-act-app/SKILL.md (new), .claude/skills/scaffold-act-app/monorepo-template.md (new), .claude/skills/scaffold-act-app/production.md (new), README.md, progress.txt
- Changes: Created Claude Code skill following the Agent Skills standard with YAML frontmatter, progressive disclosure pattern (SKILL.md under 500 lines + supporting files for templates and production guide). Updated README with skill installation instructions (project and personal). Covers spec-to-code mapping, 10-step build process, strict rules, and completion checklist.
- Decisions: Used `.claude/skills/` directory convention per Claude Code docs. Split into SKILL.md (main build process), monorepo-template.md (config files), and production.md (deployment guide). Named `scaffold-act-app` for clarity when used as a personal/cross-project skill.

[2026-02-14] #398 docs: improve skill and README for spec-driven scaffolding
- Files: .claude/skills/scaffold-act-app/SKILL.md, README.md, progress.txt
- Changes: Added "Analyze the Specification" section to SKILL.md before the Build Process. Includes generic vocabulary mapping table (Aggregate→State, Command→Action, etc.), field type mapping to Zod, state derivation from events, external vs internal event handling, and Given/When/Then→test translation with example. Updated README "AI-Assisted Application Scaffolding" section with step-by-step usage workflow (give Claude a spec link → get a working app) and added "Generic spec parsing" to the skill coverage list.
- Decisions: Placed spec analysis as a pre-step ("Analyze the Specification") before the numbered Build Process steps, keeping existing step numbering unchanged. Vocabulary mapping covers 10+ common modeling terms across tools. README workflow emphasizes any spec format works.

[2026-02-14] #398 docs: consolidate monorepo template to 2-package structure
- Files: .claude/skills/scaffold-act-app/SKILL.md, .claude/skills/scaffold-act-app/monorepo-template.md, .claude/skills/scaffold-act-app/production.md, progress.txt
- Changes: Merged separate server and client packages into a single `app` package matching the rent-stream reference. App has `src/api/` (tRPC router + bootstrap), `src/client/` (React), `src/server.ts` (production), and `src/dev-server.ts` (dev). Updated SKILL.md architecture diagram, Steps 7-8, and monorepo-template.md with new package.json, tsconfig files, install commands. Fixed production.md install reference.
- Decisions: Followed rent-stream's 2-package pattern (domain + app). Client imports AppRouter via relative path from same package. Separate tsconfig files for client (bundler resolution, noEmit) and server (ESNext, emits JS).
