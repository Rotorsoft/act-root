"use strict";(self.webpackChunkdocs=self.webpackChunkdocs||[]).push([["8319"],{9255(e,s,r){r.r(s),r.d(s,{metadata:()=>n,default:()=>h,frontMatter:()=>c,contentTitle:()=>t,toc:()=>d,assets:()=>a});var n=JSON.parse('{"id":"api/act/src/interfaces/Store","title":"Store","description":"@rotorsoft/act-root","source":"@site/docs/api/act/src/interfaces/Store.md","sourceDirName":"api/act/src/interfaces","slug":"/api/act/src/interfaces/Store","permalink":"/act-root/docs/api/act/src/interfaces/Store","draft":false,"unlisted":false,"editUrl":"https://github.com/rotorsoft/act-root/edit/master/docs/docs/api/act/src/interfaces/Store.md","tags":[],"version":"current","frontMatter":{}}'),l=r(6259),i=r(3230);let c={},t,a={},d=[{value:"Example",id:"example",level:2},{value:"See",id:"see",level:2},{value:"Extends",id:"extends",level:2},{value:"Properties",id:"properties",level:2},{value:"ack()",id:"ack",level:3},{value:"Parameters",id:"parameters",level:4},{value:"leases",id:"leases",level:5},{value:"Returns",id:"returns",level:4},{value:"Example",id:"example-1",level:4},{value:"See",id:"see-1",level:4},{value:"block()",id:"block",level:3},{value:"Parameters",id:"parameters-1",level:4},{value:"leases",id:"leases-1",level:5},{value:"Returns",id:"returns-1",level:4},{value:"Example",id:"example-2",level:4},{value:"See",id:"see-2",level:4},{value:"commit()",id:"commit",level:3},{value:"Type Parameters",id:"type-parameters",level:4},{value:"E",id:"e",level:5},{value:"Parameters",id:"parameters-2",level:4},{value:"stream",id:"stream",level:5},{value:"msgs",id:"msgs",level:5},{value:"meta",id:"meta",level:5},{value:"expectedVersion?",id:"expectedversion",level:5},{value:"Returns",id:"returns-2",level:4},{value:"Throws",id:"throws",level:4},{value:"Example",id:"example-3",level:4},{value:"dispose",id:"dispose",level:3},{value:"Inherited from",id:"inherited-from",level:4},{value:"drop()",id:"drop",level:3},{value:"Returns",id:"returns-3",level:4},{value:"Example",id:"example-4",level:4},{value:"lease()",id:"lease",level:3},{value:"Parameters",id:"parameters-3",level:4},{value:"leases",id:"leases-2",level:5},{value:"millis",id:"millis",level:5},{value:"Returns",id:"returns-4",level:4},{value:"Example",id:"example-5",level:4},{value:"See",id:"see-3",level:4},{value:"poll()",id:"poll",level:3},{value:"Parameters",id:"parameters-4",level:4},{value:"lagging",id:"lagging",level:5},{value:"leading",id:"leading",level:5},{value:"Returns",id:"returns-5",level:4},{value:"Example",id:"example-6",level:4},{value:"See",id:"see-4",level:4},{value:"query()",id:"query",level:3},{value:"Type Parameters",id:"type-parameters-1",level:4},{value:"E",id:"e-1",level:5},{value:"Parameters",id:"parameters-5",level:4},{value:"callback",id:"callback",level:5},{value:"query?",id:"query-1",level:5},{value:"Returns",id:"returns-6",level:4},{value:"Example",id:"example-7",level:4},{value:"seed()",id:"seed",level:3},{value:"Returns",id:"returns-7",level:4},{value:"Example",id:"example-8",level:4}];function o(e){let s={a:"a",blockquote:"blockquote",code:"code",em:"em",h1:"h1",h2:"h2",h3:"h3",h4:"h4",h5:"h5",hr:"hr",li:"li",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,i.R)(),...e.components};return(0,l.jsxs)(l.Fragment,{children:[(0,l.jsx)(s.p,{children:(0,l.jsx)(s.a,{href:"/act-root/docs/api/",children:(0,l.jsx)(s.strong,{children:"@rotorsoft/act-root"})})}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.a,{href:"/act-root/docs/api/",children:"@rotorsoft/act-root"})," / ",(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/",children:"act/src"})," / Store"]}),"\n",(0,l.jsx)(s.h1,{id:"interface-store",children:"Interface: Store"}),"\n",(0,l.jsxs)(s.p,{children:["Defined in: ",(0,l.jsx)(s.a,{href:"https://github.com/Rotorsoft/act-root/blob/c616f0b8462f18519d08f96d5b399abeba56944a/libs/act/src/types/ports.ts#L62",children:"libs/act/src/types/ports.ts:62"})]}),"\n",(0,l.jsx)(s.p,{children:"Interface for event store implementations."}),"\n",(0,l.jsx)(s.p,{children:"The Store interface defines the contract for persistence adapters in Act.\nImplementations must provide event storage, querying, and distributed processing\ncapabilities through leasing and watermark tracking."}),"\n",(0,l.jsx)(s.p,{children:"Act includes two built-in implementations:"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"InMemoryStore"}),": For development and testing"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"PostgresStore"}),": For production use with PostgreSQL"]}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:"Custom stores can be implemented for other databases or event log systems."}),"\n",(0,l.jsx)(s.h2,{id:"example",children:"Example"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:'import { store } from "@rotorsoft/act";\nimport { PostgresStore } from "@rotorsoft/act-pg";\n\n// Replace the default in-memory store\nstore(new PostgresStore({\n  host: "localhost",\n  port: 5432,\n  database: "myapp",\n  user: "postgres",\n  password: "secret"\n}));\n\nconst app = act()\n  .with(Counter)\n  .build();\n'})}),"\n",(0,l.jsx)(s.h2,{id:"see",children:"See"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"InMemoryStore for the default implementation"}),"\n",(0,l.jsx)(s.li,{children:"PostgresStore for the PostgreSQL implementation"}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"extends",children:"Extends"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Disposable",children:(0,l.jsx)(s.code,{children:"Disposable"})})}),"\n"]}),"\n",(0,l.jsx)(s.h2,{id:"properties",children:"Properties"}),"\n",(0,l.jsx)(s.h3,{id:"ack",children:"ack()"}),"\n",(0,l.jsxs)(s.blockquote,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"ack"}),": (",(0,l.jsx)(s.code,{children:"leases"}),") => ",(0,l.jsx)(s.code,{children:"Promise"}),"<",(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Lease",children:(0,l.jsx)(s.code,{children:"Lease"})}),"[]>"]}),"\n"]}),"\n",(0,l.jsxs)(s.p,{children:["Defined in: ",(0,l.jsx)(s.a,{href:"https://github.com/Rotorsoft/act-root/blob/c616f0b8462f18519d08f96d5b399abeba56944a/libs/act/src/types/ports.ts#L238",children:"libs/act/src/types/ports.ts:238"})]}),"\n",(0,l.jsx)(s.p,{children:"Acknowledges successful processing of leased streams."}),"\n",(0,l.jsx)(s.p,{children:"Updates the watermark to indicate events have been processed successfully.\nReleases the lease so other workers can process subsequent events."}),"\n",(0,l.jsx)(s.h4,{id:"parameters",children:"Parameters"}),"\n",(0,l.jsx)(s.h5,{id:"leases",children:"leases"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Lease",children:(0,l.jsx)(s.code,{children:"Lease"})}),"[]"]}),"\n",(0,l.jsx)(s.p,{children:"Leases to acknowledge with updated watermarks"}),"\n",(0,l.jsx)(s.h4,{id:"returns",children:"Returns"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.code,{children:"Promise"}),"<",(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Lease",children:(0,l.jsx)(s.code,{children:"Lease"})}),"[]>"]}),"\n",(0,l.jsx)(s.p,{children:"Acknowledged leases"}),"\n",(0,l.jsx)(s.h4,{id:"example-1",children:"Example"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:"const leased = await store().lease([...], 10000);\n// Process events up to ID 150\nawait store().ack(leased.map(l => ({ ...l, at: 150 })));\n"})}),"\n",(0,l.jsx)(s.h4,{id:"see-1",children:"See"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.a,{href:"#lease",children:"lease"})," for acquiring leases"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h3,{id:"block",children:"block()"}),"\n",(0,l.jsxs)(s.blockquote,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"block"}),": (",(0,l.jsx)(s.code,{children:"leases"}),") => ",(0,l.jsx)(s.code,{children:"Promise"}),"<",(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Lease",children:(0,l.jsx)(s.code,{children:"Lease"})})," & ",(0,l.jsx)(s.code,{children:"object"}),"[]>"]}),"\n"]}),"\n",(0,l.jsxs)(s.p,{children:["Defined in: ",(0,l.jsx)(s.a,{href:"https://github.com/Rotorsoft/act-root/blob/c616f0b8462f18519d08f96d5b399abeba56944a/libs/act/src/types/ports.ts#L271",children:"libs/act/src/types/ports.ts:271"})]}),"\n",(0,l.jsx)(s.p,{children:"Blocks streams after persistent processing failures."}),"\n",(0,l.jsxs)(s.p,{children:["Blocked streams won't be returned by ",(0,l.jsx)(s.a,{href:"#poll",children:"poll"})," until manually unblocked.\nThis prevents poison messages from repeatedly failing and consuming resources."]}),"\n",(0,l.jsx)(s.p,{children:"Streams are typically blocked when:"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Max retries reached"}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.code,{children:"blockOnError"})," option is true"]}),"\n",(0,l.jsx)(s.li,{children:"Handler throws an error"}),"\n"]}),"\n",(0,l.jsx)(s.h4,{id:"parameters-1",children:"Parameters"}),"\n",(0,l.jsx)(s.h5,{id:"leases-1",children:"leases"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Lease",children:(0,l.jsx)(s.code,{children:"Lease"})})," & ",(0,l.jsx)(s.code,{children:"object"}),"[]"]}),"\n",(0,l.jsx)(s.p,{children:"Leases to block with error messages"}),"\n",(0,l.jsx)(s.h4,{id:"returns-1",children:"Returns"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.code,{children:"Promise"}),"<",(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Lease",children:(0,l.jsx)(s.code,{children:"Lease"})})," & ",(0,l.jsx)(s.code,{children:"object"}),"[]>"]}),"\n",(0,l.jsx)(s.p,{children:"Blocked leases"}),"\n",(0,l.jsx)(s.h4,{id:"example-2",children:"Example"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:"try {\n  await processEvents(lease);\n  await store().ack([lease]);\n} catch (error) {\n  if (lease.retry >= 3) {\n    await store().block([{\n      ...lease,\n      error: error.message\n    }]);\n  }\n}\n"})}),"\n",(0,l.jsx)(s.h4,{id:"see-2",children:"See"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.a,{href:"#lease",children:"lease"})," for lease management"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h3,{id:"commit",children:"commit()"}),"\n",(0,l.jsxs)(s.blockquote,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"commit"}),": <",(0,l.jsx)(s.code,{children:"E"}),">(",(0,l.jsx)(s.code,{children:"stream"}),", ",(0,l.jsx)(s.code,{children:"msgs"}),", ",(0,l.jsx)(s.code,{children:"meta"}),", ",(0,l.jsx)(s.code,{children:"expectedVersion?"}),") => ",(0,l.jsx)(s.code,{children:"Promise"}),"<",(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Committed",children:(0,l.jsx)(s.code,{children:"Committed"})}),"<",(0,l.jsx)(s.code,{children:"E"}),", keyof ",(0,l.jsx)(s.code,{children:"E"}),">[]>"]}),"\n"]}),"\n",(0,l.jsxs)(s.p,{children:["Defined in: ",(0,l.jsx)(s.a,{href:"https://github.com/Rotorsoft/act-root/blob/c616f0b8462f18519d08f96d5b399abeba56944a/libs/act/src/types/ports.ts#L123",children:"libs/act/src/types/ports.ts:123"})]}),"\n",(0,l.jsx)(s.p,{children:"Commits one or more events to a stream atomically."}),"\n",(0,l.jsx)(s.p,{children:"This is the core method for persisting events. It must:"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Assign global sequence IDs to events"}),"\n",(0,l.jsx)(s.li,{children:"Increment the stream version"}),"\n",(0,l.jsx)(s.li,{children:"Check optimistic concurrency if expectedVersion is provided"}),"\n",(0,l.jsx)(s.li,{children:"Store events atomically (all or nothing)"}),"\n",(0,l.jsx)(s.li,{children:"Attach metadata (id, stream, version, created timestamp)"}),"\n"]}),"\n",(0,l.jsx)(s.h4,{id:"type-parameters",children:"Type Parameters"}),"\n",(0,l.jsx)(s.h5,{id:"e",children:"E"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.code,{children:"E"})," ",(0,l.jsx)(s.em,{children:"extends"})," ",(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Schemas",children:(0,l.jsx)(s.code,{children:"Schemas"})})]}),"\n",(0,l.jsx)(s.p,{children:"Event schemas"}),"\n",(0,l.jsx)(s.h4,{id:"parameters-2",children:"Parameters"}),"\n",(0,l.jsx)(s.h5,{id:"stream",children:"stream"}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.code,{children:"string"})}),"\n",(0,l.jsx)(s.p,{children:"The stream ID to commit to"}),"\n",(0,l.jsx)(s.h5,{id:"msgs",children:"msgs"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Message",children:(0,l.jsx)(s.code,{children:"Message"})}),"<",(0,l.jsx)(s.code,{children:"E"}),", keyof ",(0,l.jsx)(s.code,{children:"E"}),">[]"]}),"\n",(0,l.jsx)(s.p,{children:"Array of messages (events) to commit"}),"\n",(0,l.jsx)(s.h5,{id:"meta",children:"meta"}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/EventMeta",children:(0,l.jsx)(s.code,{children:"EventMeta"})})}),"\n",(0,l.jsx)(s.p,{children:"Event metadata (correlation, causation)"}),"\n",(0,l.jsx)(s.h5,{id:"expectedversion",children:"expectedVersion?"}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.code,{children:"number"})}),"\n",(0,l.jsx)(s.p,{children:"Expected current version for optimistic concurrency"}),"\n",(0,l.jsx)(s.h4,{id:"returns-2",children:"Returns"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.code,{children:"Promise"}),"<",(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Committed",children:(0,l.jsx)(s.code,{children:"Committed"})}),"<",(0,l.jsx)(s.code,{children:"E"}),", keyof ",(0,l.jsx)(s.code,{children:"E"}),">[]>"]}),"\n",(0,l.jsx)(s.p,{children:"Array of committed events with full metadata"}),"\n",(0,l.jsx)(s.h4,{id:"throws",children:"Throws"}),"\n",(0,l.jsx)(s.p,{children:"If expectedVersion doesn't match current version"}),"\n",(0,l.jsx)(s.h4,{id:"example-3",children:"Example"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:'const events = await store().commit(\n  "user-123",\n  [{ name: "UserCreated", data: { email: "user@example.com" } }],\n  { correlation: "req-456", causation: { action: {...} } },\n  0 // Expect version 0 (new stream)\n);\n'})}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h3,{id:"dispose",children:"dispose"}),"\n",(0,l.jsxs)(s.blockquote,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"dispose"}),": ",(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Disposer",children:(0,l.jsx)(s.code,{children:"Disposer"})})]}),"\n"]}),"\n",(0,l.jsxs)(s.p,{children:["Defined in: ",(0,l.jsx)(s.a,{href:"https://github.com/Rotorsoft/act-root/blob/c616f0b8462f18519d08f96d5b399abeba56944a/libs/act/src/types/ports.ts#L25",children:"libs/act/src/types/ports.ts:25"})]}),"\n",(0,l.jsx)(s.h4,{id:"inherited-from",children:"Inherited from"}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.code,{children:"Disposable.dispose"})}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h3,{id:"drop",children:"drop()"}),"\n",(0,l.jsxs)(s.blockquote,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"drop"}),": () => ",(0,l.jsx)(s.code,{children:"Promise"}),"<",(0,l.jsx)(s.code,{children:"void"}),">"]}),"\n"]}),"\n",(0,l.jsxs)(s.p,{children:["Defined in: ",(0,l.jsx)(s.a,{href:"https://github.com/Rotorsoft/act-root/blob/c616f0b8462f18519d08f96d5b399abeba56944a/libs/act/src/types/ports.ts#L92",children:"libs/act/src/types/ports.ts:92"})]}),"\n",(0,l.jsx)(s.p,{children:"Drops all data from the store."}),"\n",(0,l.jsx)(s.p,{children:"Dangerous operation that deletes all events and state. Use with extreme caution,\nprimarily for testing or development environments."}),"\n",(0,l.jsx)(s.h4,{id:"returns-3",children:"Returns"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.code,{children:"Promise"}),"<",(0,l.jsx)(s.code,{children:"void"}),">"]}),"\n",(0,l.jsx)(s.h4,{id:"example-4",children:"Example"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:"// Clean up after tests\nafterAll(async () => {\n  await store().drop();\n});\n"})}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h3,{id:"lease",children:"lease()"}),"\n",(0,l.jsxs)(s.blockquote,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"lease"}),": (",(0,l.jsx)(s.code,{children:"leases"}),", ",(0,l.jsx)(s.code,{children:"millis"}),") => ",(0,l.jsx)(s.code,{children:"Promise"}),"<",(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Lease",children:(0,l.jsx)(s.code,{children:"Lease"})}),"[]>"]}),"\n"]}),"\n",(0,l.jsxs)(s.p,{children:["Defined in: ",(0,l.jsx)(s.a,{href:"https://github.com/Rotorsoft/act-root/blob/c616f0b8462f18519d08f96d5b399abeba56944a/libs/act/src/types/ports.ts#L218",children:"libs/act/src/types/ports.ts:218"})]}),"\n",(0,l.jsx)(s.p,{children:"Acquires leases for exclusive stream processing."}),"\n",(0,l.jsx)(s.p,{children:"Leasing prevents multiple workers from processing the same stream concurrently.\nOnly grants leases if:"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsx)(s.li,{children:"Stream isn't currently leased by another worker"}),"\n",(0,l.jsx)(s.li,{children:"Lease hasn't expired"}),"\n",(0,l.jsx)(s.li,{children:"Stream isn't blocked due to errors"}),"\n"]}),"\n",(0,l.jsx)(s.h4,{id:"parameters-3",children:"Parameters"}),"\n",(0,l.jsx)(s.h5,{id:"leases-2",children:"leases"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Lease",children:(0,l.jsx)(s.code,{children:"Lease"})}),"[]"]}),"\n",(0,l.jsx)(s.p,{children:"Array of lease requests"}),"\n",(0,l.jsx)(s.h5,{id:"millis",children:"millis"}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.code,{children:"number"})}),"\n",(0,l.jsx)(s.p,{children:"Lease duration in milliseconds"}),"\n",(0,l.jsx)(s.h4,{id:"returns-4",children:"Returns"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.code,{children:"Promise"}),"<",(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Lease",children:(0,l.jsx)(s.code,{children:"Lease"})}),"[]>"]}),"\n",(0,l.jsx)(s.p,{children:"Array of successfully granted leases"}),"\n",(0,l.jsx)(s.h4,{id:"example-5",children:"Example"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:'const granted = await store().lease([\n  { stream: "user-123", by: workerId, at: 0, retry: 0, lagging: false }\n], 10000); // 10 second lease\n\nif (granted.length > 0) {\n  // Process events...\n  await store().ack(granted);\n}\n'})}),"\n",(0,l.jsx)(s.h4,{id:"see-3",children:"See"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.a,{href:"#poll",children:"poll"})," for finding streams to lease"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.a,{href:"#ack",children:"ack"})," for acknowledging completion"]}),"\n"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h3,{id:"poll",children:"poll()"}),"\n",(0,l.jsxs)(s.blockquote,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"poll"}),": (",(0,l.jsx)(s.code,{children:"lagging"}),", ",(0,l.jsx)(s.code,{children:"leading"}),") => ",(0,l.jsx)(s.code,{children:"Promise"}),"<",(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Poll",children:(0,l.jsx)(s.code,{children:"Poll"})}),"[]>"]}),"\n"]}),"\n",(0,l.jsxs)(s.p,{children:["Defined in: ",(0,l.jsx)(s.a,{href:"https://github.com/Rotorsoft/act-root/blob/c616f0b8462f18519d08f96d5b399abeba56944a/libs/act/src/types/ports.ts#L188",children:"libs/act/src/types/ports.ts:188"})]}),"\n",(0,l.jsx)(s.p,{children:"Polls for streams that need reaction processing."}),"\n",(0,l.jsx)(s.p,{children:"Returns streams that have uncommitted events, ordered by their watermark.\nUses a dual-frontier approach:"}),"\n",(0,l.jsxs)(s.ul,{children:["\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Lagging"}),": New or behind streams (ascending watermark)"]}),"\n",(0,l.jsxs)(s.li,{children:[(0,l.jsx)(s.strong,{children:"Leading"}),": Active streams (descending watermark)"]}),"\n"]}),"\n",(0,l.jsx)(s.p,{children:"Only returns unblocked streams that aren't currently leased."}),"\n",(0,l.jsx)(s.h4,{id:"parameters-4",children:"Parameters"}),"\n",(0,l.jsx)(s.h5,{id:"lagging",children:"lagging"}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.code,{children:"number"})}),"\n",(0,l.jsx)(s.p,{children:"Max streams to return from lagging frontier"}),"\n",(0,l.jsx)(s.h5,{id:"leading",children:"leading"}),"\n",(0,l.jsx)(s.p,{children:(0,l.jsx)(s.code,{children:"number"})}),"\n",(0,l.jsx)(s.p,{children:"Max streams to return from leading frontier"}),"\n",(0,l.jsx)(s.h4,{id:"returns-5",children:"Returns"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.code,{children:"Promise"}),"<",(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Poll",children:(0,l.jsx)(s.code,{children:"Poll"})}),"[]>"]}),"\n",(0,l.jsx)(s.p,{children:"Array of poll results with stream, source, watermark, and lag status"}),"\n",(0,l.jsx)(s.h4,{id:"example-6",children:"Example"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:"const polled = await store().poll(5, 5); // 5 lagging + 5 leading\npolled.forEach(({ stream, at, lagging }) => {\n  console.log(`${stream} at ${at} (lagging: ${lagging})`);\n});\n"})}),"\n",(0,l.jsx)(s.h4,{id:"see-4",children:"See"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Lease",children:"Lease"})," for lease management"]}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h3,{id:"query",children:"query()"}),"\n",(0,l.jsxs)(s.blockquote,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"query"}),": <",(0,l.jsx)(s.code,{children:"E"}),">(",(0,l.jsx)(s.code,{children:"callback"}),", ",(0,l.jsx)(s.code,{children:"query?"}),") => ",(0,l.jsx)(s.code,{children:"Promise"}),"<",(0,l.jsx)(s.code,{children:"number"}),">"]}),"\n"]}),"\n",(0,l.jsxs)(s.p,{children:["Defined in: ",(0,l.jsx)(s.a,{href:"https://github.com/Rotorsoft/act-root/blob/c616f0b8462f18519d08f96d5b399abeba56944a/libs/act/src/types/ports.ts#L159",children:"libs/act/src/types/ports.ts:159"})]}),"\n",(0,l.jsx)(s.p,{children:"Queries events from the store with optional filtering."}),"\n",(0,l.jsx)(s.p,{children:"Calls the callback for each matching event. The callback approach allows\nprocessing large result sets without loading everything into memory."}),"\n",(0,l.jsx)(s.h4,{id:"type-parameters-1",children:"Type Parameters"}),"\n",(0,l.jsx)(s.h5,{id:"e-1",children:"E"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.code,{children:"E"})," ",(0,l.jsx)(s.em,{children:"extends"})," ",(0,l.jsx)(s.a,{href:"/act-root/docs/api/act/src/type-aliases/Schemas",children:(0,l.jsx)(s.code,{children:"Schemas"})})]}),"\n",(0,l.jsx)(s.p,{children:"Event schemas"}),"\n",(0,l.jsx)(s.h4,{id:"parameters-5",children:"Parameters"}),"\n",(0,l.jsx)(s.h5,{id:"callback",children:"callback"}),"\n",(0,l.jsxs)(s.p,{children:["(",(0,l.jsx)(s.code,{children:"event"}),") => ",(0,l.jsx)(s.code,{children:"void"})]}),"\n",(0,l.jsx)(s.p,{children:"Function invoked for each matching event"}),"\n",(0,l.jsx)(s.h5,{id:"query-1",children:"query?"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.code,{children:"Readonly"}),"<{ ",(0,l.jsx)(s.code,{children:"after?"}),": ",(0,l.jsx)(s.code,{children:"number"}),"; ",(0,l.jsx)(s.code,{children:"backward?"}),": ",(0,l.jsx)(s.code,{children:"boolean"}),"; ",(0,l.jsx)(s.code,{children:"before?"}),": ",(0,l.jsx)(s.code,{children:"number"}),"; ",(0,l.jsx)(s.code,{children:"correlation?"}),": ",(0,l.jsx)(s.code,{children:"string"}),"; ",(0,l.jsx)(s.code,{children:"created_after?"}),": ",(0,l.jsx)(s.code,{children:"Date"}),"; ",(0,l.jsx)(s.code,{children:"created_before?"}),": ",(0,l.jsx)(s.code,{children:"Date"}),"; ",(0,l.jsx)(s.code,{children:"limit?"}),": ",(0,l.jsx)(s.code,{children:"number"}),"; ",(0,l.jsx)(s.code,{children:"names?"}),": ",(0,l.jsx)(s.code,{children:"string"}),"[]; ",(0,l.jsx)(s.code,{children:"stream?"}),": ",(0,l.jsx)(s.code,{children:"string"}),"; ",(0,l.jsx)(s.code,{children:"with_snaps?"}),": ",(0,l.jsx)(s.code,{children:"boolean"}),"; }>"]}),"\n",(0,l.jsx)(s.p,{children:"Optional filter criteria"}),"\n",(0,l.jsx)(s.h4,{id:"returns-6",children:"Returns"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.code,{children:"Promise"}),"<",(0,l.jsx)(s.code,{children:"number"}),">"]}),"\n",(0,l.jsx)(s.p,{children:"Total number of events processed"}),"\n",(0,l.jsx)(s.h4,{id:"example-7",children:"Example"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:'let count = 0;\nawait store().query(\n  (event) => {\n    console.log(event.name, event.data);\n    count++;\n  },\n  { stream: "user-123" }\n);\nconsole.log(`Found ${count} events`);\n'})}),"\n",(0,l.jsx)(s.hr,{}),"\n",(0,l.jsx)(s.h3,{id:"seed",children:"seed()"}),"\n",(0,l.jsxs)(s.blockquote,{children:["\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.strong,{children:"seed"}),": () => ",(0,l.jsx)(s.code,{children:"Promise"}),"<",(0,l.jsx)(s.code,{children:"void"}),">"]}),"\n"]}),"\n",(0,l.jsxs)(s.p,{children:["Defined in: ",(0,l.jsx)(s.a,{href:"https://github.com/Rotorsoft/act-root/blob/c616f0b8462f18519d08f96d5b399abeba56944a/libs/act/src/types/ports.ts#L77",children:"libs/act/src/types/ports.ts:77"})]}),"\n",(0,l.jsx)(s.p,{children:"Initializes or resets the store."}),"\n",(0,l.jsx)(s.p,{children:"Used primarily for testing to ensure a clean state between tests.\nFor production stores, this might create necessary tables or indexes."}),"\n",(0,l.jsx)(s.h4,{id:"returns-7",children:"Returns"}),"\n",(0,l.jsxs)(s.p,{children:[(0,l.jsx)(s.code,{children:"Promise"}),"<",(0,l.jsx)(s.code,{children:"void"}),">"]}),"\n",(0,l.jsx)(s.h4,{id:"example-8",children:"Example"}),"\n",(0,l.jsx)(s.pre,{children:(0,l.jsx)(s.code,{className:"language-typescript",children:"// Reset store between tests\nbeforeEach(async () => {\n  await store().seed();\n});\n"})})]})}function h(e={}){let{wrapper:s}={...(0,i.R)(),...e.components};return s?(0,l.jsx)(s,{...e,children:(0,l.jsx)(o,{...e})}):o(e)}},3230(e,s,r){r.d(s,{R:()=>c,x:()=>t});var n=r(1299);let l={},i=n.createContext(l);function c(e){let s=n.useContext(i);return n.useMemo(function(){return"function"==typeof e?e(s):{...s,...e}},[s,e])}function t(e){let s;return s=e.disableParentContext?"function"==typeof e.components?e.components(l):e.components||l:c(e.components),n.createElement(i.Provider,{value:s},e.children)}}}]);